/*! media-credit media-credit-attachment-details.js 2023-04-01 5:33:50 PM */
jQuery(function(o){"use strict";var r=mundschenk.mediaCredit||{};r.autoComplete=function(a,e,d){function n(e){a.model.set({mediaCreditAuthorID:"",mediaCreditAuthorDisplay:e,mediaCreditText:e}),d&&a.model.save()}return a.$el.find(e).autocomplete({autoFocus:!0,minLength:2,source:r.names||(r.names=_.map(r.id,function(e,t){return{id:t,value:e,label:e}})),select:function(e,t){return o(this).prop("value",t.item.value),a.model.set({mediaCreditAuthorID:t.item.id,mediaCreditAuthorDisplay:t.item.value,mediaCreditText:t.item.value}),d&&a.model.save(),!1},response:function(e,t){0===t.content.length&&(t=o(this).val())!==a.model.get("mediaCreditAuthorDisplay")&&n(t)},open:function(){return o(this).autocomplete("widget").css("z-index",2e6),!1}}).click(function(){this.select()}).change(function(e){var t=o(this),i=t.val();(r.options.noDefaultCredit||!1)&&""===i&&""===a.model.get("mediaCreditAuthorID")?(a.model.set({mediaCreditAuthorID:a.model.get("author"),mediaCreditAuthorDisplay:a.model.get("authorName"),mediaCreditText:a.model.get("authorName")}),d&&a.model.save(),t.val("").prop("placeholder",a.model.get("mediaCredit.placeholder")),e.stopImmediatePropagation(),e.preventDefault()):i!==a.model.get("mediaCreditAuthorDisplay")&&(n(i),e.stopImmediatePropagation(),e.preventDefault())})},wp.media.view.Attachment.Details&&_.extend(wp.media.view.Attachment.Details.prototype,{template:function(e){return wp.media.template("attachment-details")(e)+wp.media.template("media-credit-attachment-details")(e)},_render:wp.media.view.Attachment.Details.prototype.render,render:function(){var e,t=r.options.noDefaultCredit||!1;this._render(this),e=r.autoComplete(this,'label[data-setting="mediaCreditText"] input[type="text"]',!0),t?(e.autocomplete("disable"),""!==this.model.get("mediaCreditAuthorID")&&e.val("").prop("placeholder",this.model.get("mediaCredit.placeholder"))):e.autocomplete("enable")},_updateSetting:wp.media.view.Attachment.Details.prototype.updateSetting,updateSetting:function(e){var t=o(e.target);t.is('input[type="checkbox"]')&&(e.target.value=t.prop("checked")?1:0),this._updateSetting(e)}}),wp.media.view.Attachment.Details.TwoColumn&&_.extend(wp.media.view.Attachment.Details.TwoColumn.prototype,{template:function(e){var t=o(o.parseHTML(wp.media.template("attachment-details-two-column")(e)));return o(wp.media.template("media-credit-attachment-details")(e)).insertAfter(t.find(".attachment-compat").prevAll("*[data-setting]")[0]),t}}),wp.media.model.Attachment&&_.extend(wp.media.model.Attachment.prototype,{_sync:wp.media.model.Attachment.prototype.sync,sync:function(e,i,t){var a,d,n={};return!_.isUndefined(this.id)&&(d=this.id,"update"===e&&i.hasChanged()&&(r.options.noDefaultCredit&&""===i.changed.mediaCreditText&&""!==i.get("mediaCreditAuthorID")&&delete i.changed.mediaCreditText,_.each(i.changed,function(e,t){0===t.indexOf("mediaCredit")&&("mediaCreditAuthorID"===t?n.user_id=this.get(t)||0:"mediaCreditText"===t?n.freeform=this.get(t):"mediaCreditLink"===t?n.url=this.get(t):"mediaCreditNoFollow"===t&&(n.flags=n.flags||{},n.flags.nofollow=this.get(t)),delete i.changed[t])},this),0<_.size(n))&&((a=new wp.api.models.Media({id:this.id})).fetch(),a.set("media_credit",{raw:n}),a.save({status:"publish"}),this.updateMediaCreditInEditorContent(o("textarea#content").val(),d,i)),"update"!==e||i.hasChanged())?this._sync(e,i,t):o.Deferred().rejectWith(this).promise()},updateMediaCreditInEditorContent:function(i,e,t){i&&wp.apiRequest({namespace:"media-credit/v1",endpoint:"replace_in_content",data:{content:i,attachment_id:e||0,author_id:t.get("mediaCreditAuthorID")||0,freeform:t.get("mediaCreditText"),url:t.get("mediaCreditLink"),nofollow:t.get("mediaCreditNoFollow")},success:function(e){var t;i!==e&&((t=tinymce.get("content"))&&t instanceof tinymce.Editor&&o("#wp-content-wrap").hasClass("tmce-active")?(t.setContent(e),t.save({no_events:!0})):o("textarea#content").val(e))}})}})});