/*! media-credit media-credit-tinymce.js 2023-04-01 5:33:50 PM */
tinymce.PluginManager.add("mediacredit",function(f){"use strict";var o,w,a,c,n,e=tinymce.each,l=tinymce.trim,t=tinymce.Env.iOS;function i(e){return!(!f.dom.getAttrib(e,"data-mce-placeholder")&&!f.dom.getAttrib(e,"data-mce-object"))}function d(e){e=f.$(e).parents("[contenteditable]");return e&&"false"===e.attr("contenteditable")}function r(e){e=e.replace(/(?:<p>)?\[(?:wp_)?caption([^\]]+)\]([\s\S]+?)\[\/(?:wp_)?caption\](?:<\/p>)?/g,function(e,t,a){var n,i,d,r,o,c=t.match(/id=['"]([^'"]*)['"] ?/);return(o=(t=(i=(t=(n=(t=c?t.replace(c[0],""):t).match(/align=['"]([^'"]*)['"] ?/))?t.replace(n[0],""):t).match(/class=['"]([^'"]*)['"] ?/))?t.replace(i[0],""):t).match(/width=['"]([0-9]*)['"] ?/))&&(t=t.replace(o[0],"")),r=s(r=(r=(a=l(a)).match(/((?:\[media-credit[^\]]+\].*?)(?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?(?:.*?\[\/media-credit\])?)([\s\S]*)/i)||a.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i))&&r[2]?(d=l(r[2]),l(r[1])):(d=l(t).replace(/caption=['"]/,"").replace(/['"]$/,""),a),!1),c=c&&c[1]?c[1].replace(/[<>&]+/g,""):"",n=n&&n[1]?n[1]:"alignnone",i=i&&i[1]?" "+i[1].replace(/[<>&]+/g,""):"",(o=(o=!o&&r?r.match(/width=['"]([0-9]*)['"]/):o)&&o[1]?o[1]:o)&&d?(o=parseInt(o,10),f.getParam("wpeditimage_html5_captions")||(o+=10),'<div class="mceTemp'+(r.match(/<span class="mceMediaCreditTemp/)?" mceMediaCredit":"")+'"><dl id="'+c+'" class="wp-caption '+n+i+'" style="width: '+o+'px"><dt class="wp-caption-dt">'+r+'</dt><dd class="wp-caption-dd">'+d+"</dd></dl></div>"):a});return s(e,!0)}function s(e,i){return wp.shortcode.replace("media-credit",e,function(e){var t,a=l(e.content),n=a.match(/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)([\s\S]*)/i);return n&&n[1]&&(n=l(n[1])),(e=e.attrs.named).id=e.id||"",e.name=e.name||"",e.align=e.align||"alignnone",e.link=e.link||"",e.nofollow=e.nofollow||"",!e.width&&n&&(e.width=wp.html.attrs(n).width),e.width=parseInt(e.width,10),e.width&&(e.name||e.id)?(f.getParam("wpeditimage_html5_captions")||(e.width+=10),t=(t=e.name||mundschenk.mediaCredit.id[e.id]+mundschenk.mediaCredit.options.separator+mundschenk.mediaCredit.options.organization).replace(/<[^>]+>(.*)<\/[^>]+>/g,"$1"),n=n+wp.html.string({tag:"span",content:t,attrs:{class:"mceMediaCreditTemp mceNonEditable","data-media-credit-author-id":_.escape(e.id),"data-media-credit-text":_.escape(e.name),"data-media-credit-align":_.escape(e.align),"data-media-credit-link":_.escape(e.link),"data-media-credit-nofollow":_.escape(e.nofollow)}}),i?wp.html.string({tag:"div",content:n,attrs:{class:"mceMediaCreditOuterTemp "+_.escape(e.align),style:"width: "+e.width+"px"}}):n):a})}function m(e){e=e.replace(/(?:<div [^>]+mceTemp[^>]+>)?\s*(<dl [^>]+wp-caption[^>]+>[\s\S]+?<\/dl>)\s*(?:<\/div>)?/g,function(e,t){var a="";return-1===t.indexOf("<img ")||-1!==t.indexOf("</p>")?t.replace(/<d[ldt]( [^>]+)?>/g,"").replace(/<\/d[ldt]>/g,""):-1===(a=t.replace(/\s*<dl ([^>]+)>\s*<dt [^>]+>([\s\S]+?)<\/dt>\s*<dd [^>]+>([\s\S]*?)<\/dd>\s*<\/dl>\s*/gi,function(e,t,a,n){var i,d,r=a.match(/width="([0-9]*)"/);return r=r&&r[1]?r[1]:"",d=(i=(i=t.match(/class="([^"]*)"/))&&i[1]?i[1]:"").match(/align[a-z]+/i)||"alignnone",r&&n?(t=(t=t.match(/id="([^"]*)"/))&&t[1]?t[1]:"",i=(i=i.replace(/wp-caption ?|align[a-z]+ ?/gi,""))&&' class="'+i+'"',n=(n=n.replace(/\r\n|\r/g,"\n").replace(/<[a-zA-Z0-9]+( [^<>]+)?>/g,function(e){return e.replace(/[\r\n\t]+/," ")})).replace(/\s*\n\s*/g,"<br />"),'[caption id="'+t+'" align="'+d+'" width="'+r+'"'+i+"]"+(a=p(a,!1))+" "+n+"[/caption]"):"alignnone"!==d[0]?a.replace(/><img/,' class="'+d[0]+'"><img'):a})).indexOf("[caption")?t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2"):a});return p(e,!0)}function p(e,t){return e.replace(t?/<div class="mceMediaCreditOuterTemp[^"]*"[^>]*>.*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?).*?<span class="mceMediaCreditTemp[^"]*" ([^>]*)>([\s\S]+?)<\/span>[^<>]*<\/div>/g:/((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?).*?<span class="mceMediaCreditTemp[^"]*" ([^>]*)>([\s\S]+?)<\/span>/g,function(e,t,a,n){var i;return-1===t.indexOf("<img ")?"<p>"+n+"</p>":(n=wp.html.attrs(a),(i={tag:"media-credit",attrs:{id:_.unescape(n["data-media-credit-author-id"]),name:_.unescape(n["data-media-credit-text"]),link:_.unescape(n["data-media-credit-link"]),nofollow:"true"===_.unescape(n["data-media-credit-nofollow"]),align:_.unescape(n["data-media-credit-align"]),width:wp.html.attrs(t).width},content:t,type:"closed"}).attrs.id?i.attrs.name=void 0:i.attrs.id=void 0,_.each(Object.keys(i.attrs),function(e){i.attrs[e]||delete i.attrs[e]}),i.attrs.width&&(i.attrs.name||i.attrs.id)?0!==(a=wp.shortcode.string(i)).indexOf("[media-credit")?t.replace(/[\s\S]*?((?:<a [^>]+>)?<img [^>]+>(?:<\/a>)?)(<p>[\s\S]*<\/p>)?[\s\S]*/gi,"<p>$1</p>$2"):a:t)})}function C(e){return e&&(e.textContent||e.innerText).replace(/\ufeff/g,"")}function g(e){var t=f.dom.getParent(e,"div.mceTemp")||f.dom.getParent(e,"div.mceMediaCreditOuterTemp");(t=t||"IMG"!==e.nodeName?t:f.dom.getParent(e,"a"))?(t.nextSibling?f.selection.select(t.nextSibling):t.previousSibling?f.selection.select(t.previousSibling):f.selection.select(t.parentNode),f.selection.collapse(!0),f.dom.remove(t)):f.dom.remove(e),f.nodeChanged(),f.undoManager.add()}return f.addButton("wp_img_remove",{tooltip:"Remove",icon:"dashicon dashicons-no",onclick:function(){g(f.selection.getNode())}}),f.addButton("wp_img_edit",{tooltip:"Edit|button",icon:"dashicon dashicons-edit",onclick:function(){var e,t,a,h;e=f.selection.getNode(),"undefined"!=typeof wp&&wp.media?(a=function(e){var t,a,n,i,d,r=[],o=f.dom,c=/^\d+$/;(a={attachment_id:!1,size:"custom",caption:"",align:"none",extraClasses:"",link:!1,linkUrl:"",linkClassName:"",linkTargetBlank:!1,linkRel:"",title:"",mediaCreditText:"",mediaCreditAuthorID:"",mediaCreditLink:"",mediaCreditNoFollow:""}).url=o.getAttrib(e,"src"),a.alt=o.getAttrib(e,"alt"),a.title=o.getAttrib(e,"title"),i=o.getAttrib(e,"width"),d=o.getAttrib(e,"height"),(!c.test(i)||parseInt(i,10)<1)&&(i=e.naturalWidth||e.width);(!c.test(d)||parseInt(d,10)<1)&&(d=e.naturalHeight||e.height);a.customWidth=a.width=i,a.customHeight=a.height=d,c=tinymce.explode(e.className," "),t=[],tinymce.each(c,function(e){/^wp-image/.test(e)?a.attachment_id=parseInt(e.replace("wp-image-",""),10):/^align/.test(e)?a.align=e.replace("align",""):/^size/.test(e)?a.size=e.replace("size-",""):t.push(e)}),a.extraClasses=t.join(" "),a.captionClassName=r.join(" "),(i=o.getParents(e,".wp-caption")).length&&(i=i[0],c=i.className.split(" "),tinymce.each(c,function(e){/^align/.test(e)?a.align=e.replace("align",""):e&&"wp-caption"!==e&&r.push(e)}),(d=o.select("dd.wp-caption-dd",i)).length)&&(d=d[0],a.caption=f.serializer.serialize(d).replace(/<br[^>]*>/g,"$&\n").replace(/^<p>/,"").replace(/<\/p>$/,""));e.parentNode&&"A"===e.parentNode.nodeName&&(n=e.parentNode,a.linkUrl=o.getAttrib(n,"href"),a.linkTargetBlank="_blank"===o.getAttrib(n,"target"),a.linkRel=o.getAttrib(n,"rel"),a.linkClassName=n.className);c=n?o.getNext(n,".mceMediaCreditTemp"):o.getNext(e,".mceMediaCreditTemp");c&&(a.align=a.align&&"none"!==a.align?a.align:o.getAttrib(c,"data-media-credit-align","").replace("align",""),a.mediaCreditText=o.getAttrib(c,"data-media-credit-text",""),a.mediaCreditAuthorID=o.getAttrib(c,"data-media-credit-author-id",""),a.mediaCreditLink=o.getAttrib(c,"data-media-credit-link",""),a.mediaCreditNoFollow=o.getAttrib(c,"data-media-credit-nofollow",""));return a}(e),f.$(e).attr("data-wp-editing",1),wp.media.events.trigger("editor:image-edit",{editor:f,metadata:a,image:e}),t=wp.media({frame:"image",state:"image-details",metadata:a}),wp.media.events.trigger("editor:frame-create",{frame:t}),e=function(u){f.undoManager.transact(function(){var e,t,a,n,i,d,r,o,c,l,s,m,p,g;e=h,p=!(!(t=u).mediaCreditText&&!t.mediaCreditAuthorID),g=f.dom,e&&e.length&&(i=e[0],d=(d=tinymce.explode(t.extraClasses," "))||[],a=i.parentNode&&"A"===i.parentNode.nodeName&&!C(i.parentNode)?i.parentNode:i,c=g.getNext(a,".mceMediaCreditTemp"),t.caption||(c?g.setAttrib(c,"data-media-credit-align","align"+t.align):d.push("align"+t.align)),t.attachment_id&&(d.push("wp-image-"+t.attachment_id),t.size)&&"custom"!==t.size&&d.push("size-"+t.size),r=t.width,m=t.height,"custom"===t.size&&(r=t.customWidth,m=t.customHeight),m={src:t.url,width:r||null,height:m||null,title:t.title||null,class:d.join(" ")||null},g.setAttribs(i,m),e.attr("alt",t.alt||""),d={href:t.linkUrl,rel:t.linkRel||null,target:t.linkTargetBlank?"_blank":null,class:t.linkClassName||null},i.parentNode&&"A"===i.parentNode.nodeName&&!C(i.parentNode)?t.linkUrl?g.setAttribs(i.parentNode,d):g.remove(i.parentNode,!0):t.linkUrl&&((m=g.getParent(i,"a"))&&g.insertAfter(i,m),m=g.create("a",d),i.parentNode.insertBefore(m,i),m.appendChild(i)),d=f.dom.getParent(i,".mceTemp"),r=parseInt(r,10),f.getParam("wpeditimage_html5_captions")||(r+=10),t.caption?(t.caption=function(e){if(!e||-1===e.indexOf("<")&&-1===e.indexOf(">"))return e;w=w||new tinymce.html.Serializer({},f.schema);return w.serialize(f.parser.parse(e,{forced_root_block:!1}))}(t.caption),m=t.attachment_id?"attachment_"+t.attachment_id:null,o="align"+(t.align||"none"),l="wp-caption "+o,t.captionClassName&&(l+=" "+t.captionClassName.replace(/[<>&]+/g,"")),c&&g.setAttrib(c,"data-media-credit-align",o),d?((s=g.select("dl.wp-caption",d)).length&&g.setAttribs(s,{id:m,class:l,style:"width: "+r+"px"}),(s=g.select(".wp-caption-dd",d)).length&&g.setHTML(s[0],t.caption),g.toggleClass(d,"mceMediaCredit",p)):(s="<dl "+(m=m?'id="'+m+'" ':"")+'class="'+l+'" style="width: '+r+'px"><dt class="wp-caption-dt"></dt><dd class="wp-caption-dd">'+t.caption+"</dd></dl>",m=g.create("div",{class:"mceTemp"+(p?" mceMediaCredit":"")},s),(n=g.getParent(a,"p")||g.getParent(a,".mceMediaCreditOuterTemp"))?(n.parentNode.insertBefore(m,n),g.remove(a),c&&g.remove(c)):a.parentNode.insertBefore(m,a),a=f.$(m).find("dt.wp-caption-dt").append(a),n&&g.isEmpty(n)&&g.remove(n),c&&a.append(c))):(d?(c=g.getNext(a,".mceMediaCreditTemp"),n=c&&p?(o="align"+(t.align||"none"),g.create("div",{class:"mceMediaCreditOuterTemp "+o,style:"width: "+r+"px"})):g.create("p"),d.parentNode.insertBefore(n,d),n.appendChild(a),c&&p&&n.appendChild(c),g.remove(d)):(l=g.getParent(c,".mceMediaCreditOuterTemp"))&&(p?(o="align"+(t.align||"none"),l.className=l.className.replace(/ ?align(left|center|right|none)/g," ")+o,g.setAttrib(l,"style","width: "+r+"px")):(n=g.create("p"),l.parentNode.insertBefore(n,l),n.appendChild(a),g.remove(l))),e=f.$(i),s=e.attr("srcset"),m=e.attr("src"),s&&m&&(m=m.replace(/[?#].*/,""),-1===s.indexOf(m))&&e.attr("srcset",null).attr("sizes",null)),wp.media.events&&wp.media.events.trigger("editor:image-update",{editor:f,metadata:t,image:i}),f.nodeChanged())}),t.detach()},t.state("image-details").on("update",e),t.state("replace-image").on("replace",e),t.on("close",function(){f.focus(),t.detach(),(h=f.$("img[data-wp-editing]")).removeAttr("data-wp-editing")}),t.open()):f.execCommand("mceImage")}}),e({alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",alignnone:"No alignment"},function(e,a){var t=a.slice(5);f.addButton("wp_img_"+a,{tooltip:e,icon:"dashicon dashicons-align-"+t,cmd:"alignnone"===a?"wpAlignNone":"Justify"+t.slice(0,1).toUpperCase()+t.slice(1),onPostRender:function(){var t=this;f.on("NodeChange",function(e){"IMG"===e.element.nodeName&&(e=f.dom.getParent(e.element,".wp-caption")||e.element,"alignnone"===a?t.active(!/\balign(left|center|right)\b/.test(e.className)):t.active(f.dom.hasClass(e,a)))})}})}),f.once("preinit",function(){f.wp&&f.wp._createToolbar&&(o=f.wp._createToolbar(["wp_img_alignleft","wp_img_aligncenter","wp_img_alignright","wp_img_alignnone","wp_img_edit","wp_img_remove"]))}),f.on("wptoolbar",function(e){"IMG"!==e.element.nodeName||i(e.element)||(e.toolbar=o)}),t&&f.on("init",function(){f.on("touchstart",function(e){"IMG"!==e.target.nodeName||d(e.target)||(a=!0)}),f.dom.bind(f.getDoc(),"touchmove",function(){a=!1}),f.on("touchend",function(e){var t;a&&"IMG"===e.target.nodeName&&!d(e.target)?(t=e.target,a=!1,window.setTimeout(function(){f.selection.select(t),f.nodeChanged()},100)):o&&o.hide()})}),f.on("init",function(){var t=f.dom,e=f.getParam("wpeditimage_html5_captions")?"html5-captions":"html4-captions";t.addClass(f.getBody(),e),tinymce.Env.ie&&10<tinymce.Env.ie&&t.bind(f.getBody(),"mscontrolselect",function(e){"IMG"===e.target.nodeName&&t.getParent(e.target,".wp-caption")?f.getBody().focus():"DL"===e.target.nodeName&&t.hasClass(e.target,"wp-caption")&&e.target.focus()})}),f.on("ObjectResized",function(n){var i=n.target;"IMG"===i.nodeName&&f.undoManager.transact(function(){var e,t,a=f.dom;"IMG"===i.nodeName&&(i.className=i.className.replace(/\bsize-[^ ]+/,""),e=a.getParent(i,".wp-caption")||a.getParent(i,".mceMediaCreditOuterTemp"))&&(t=n.width||a.getAttrib(i,"width"))&&(t=parseInt(t,10),f.getParam("wpeditimage_html5_captions")||(t+=10),a.setStyle(e,"width",t+"px"))})}),f.on("pastePostProcess",function(e){f.dom.getParent(f.selection.getNode(),"dd.wp-caption-dd")&&(f.$("img, audio, video, object, embed, iframe, script, style",e.node).remove(),f.$("*",e.node).each(function(e,t){f.dom.isBlock(t)&&(tinymce.trim(t.textContent||t.innerText)?(f.dom.insertAfter(f.dom.create("br"),t),f.dom.remove(t,!0)):f.dom.remove(t))}),f.$("br",e.node).each(function(e,t){t.nextSibling&&"BR"!==t.nextSibling.nodeName&&t.previousSibling&&"BR"!==t.previousSibling.nodeName||f.dom.remove(t)}),c=!0)}),f.on("BeforeExecCommand",function(e){var t,a,n,i,d=e.command,r=f.dom;if("mceInsertContent"===d||"Indent"===d||"Outdent"===d){if(i=f.selection.getNode(),n=r.getParent(i,"div.mceTemp")||r.getParent(i,"div.mceMediaCreditOuterTemp")){if("mceInsertContent"!==d)return e.preventDefault(),e.stopImmediatePropagation(),!1;c?c=!1:(t=r.create("p"),r.insertAfter(t,n),f.selection.setCursorLocation(t,0),"IMG"===i.nodeName&&f.$(n).remove(),f.nodeChanged())}}else"JustifyLeft"!==d&&"JustifyRight"!==d&&"JustifyCenter"!==d&&"wpAlignNone"!==d||(i=f.selection.getNode(),t="align"+d.slice(7).toLowerCase(),n=f.dom.getParent(i,".wp-caption"),"IMG"!==i.nodeName&&!n)||(n=r.getNext(r.getParent(i=n||i,"a"),".mceMediaCreditTemp")||r.select(".mceMediaCreditTemp",i),a=f.dom.hasClass(i,t)?" alignnone":" "+t,i.className=l(i.className.replace(/ ?align(left|center|right|none)/g,"")+a),n&&(r.setAttrib(n,"data-media-credit-align",t),i=r.getParent(n,"div.mceMediaCreditOuterTemp"))&&(i.className=l(i.className.replace(/ ?align(left|center|right|none)/g,"")+a)),f.nodeChanged(),e.preventDefault(),o&&o.reposition(),f.fire("ExecCommand",{command:d,ui:e.ui,value:e.value}))}),f.on("keydown",function(e){var t,a,n,i=f.selection,d=e.keyCode,r=f.dom,o=tinymce.util.VK;if(d===o.ENTER)t=i.getNode(),(a=r.getParent(t,"div.mceTemp")||r.getParent(t,"div.mceMediaCreditOuterTemp"))&&(r.events.cancel(e),tinymce.each(r.select("dt, dd",a),function(e){r.isEmpty(e)&&r.remove(e)}),n=tinymce.Env.ie&&tinymce.Env.ie<11?"":'<br data-mce-bogus="1" />',n=r.create("p",null,n),"DD"===t.nodeName||"DT"===t.nodeName||t===a?r.insertAfter(n,a):a.parentNode.insertBefore(n,a),f.nodeChanged(),i.setCursorLocation(n,0));else if((d===o.DELETE||d===o.BACKSPACE)&&("DIV"===(t=i.getNode()).nodeName&&(r.hasClass(t,"mceTemp")||r.hasClass(t,"mceMediaCreditOuterTemp"))?a=t:"IMG"!==t.nodeName&&"DT"!==t.nodeName&&"A"!==t.nodeName||(a=r.getParent(t,"div.mceTemp")||r.getParent(t,"div.mceMediaCreditOuterTemp")),a))return r.events.cancel(e),g(t),!1}),f.on("NodeChange",function(e){var t="",a=!1,n=e.element,i=f.dom,d=i.getParent(n,"div.mceTemp")||i.getParent(n,"div.mceMediaCreditOuterTemp");if(d)return"A"===n.nodeName&&0===n.children.length?(t=n.textContent,a=!0):"DIV"===n.nodeName&&i.hasClass(n,"mceMediaCreditOuterTemp")&&1===n.children.length&&i.hasClass(n.firstElementChild,"mceMediaCreditTemp")&&(t=n.firstChild.textContent,a=!0),a?(n=i.create("p",null,t),i.insertAfter(n,d),i.events.cancel(e),i.remove(d),!1):void 0}),tinymce.Env.gecko&&f.on("undo redo",function(){"IMG"===f.selection.getNode().nodeName&&f.selection.collapse()}),f.wpSetImgCaption=r,f.wpGetImgCaption=m,f.on("BeforeGetContent",function(e){"raw"!==e.format&&f.$('img[id="__wp-temp-img-id"]').removeAttr("id")}),f.on("BeforeSetContent",function(e){"raw"!==e.format&&(e.content=f.wpSetImgCaption(e.content))}),f.on("PostProcess",function(e){e.get&&(e.content=f.wpGetImgCaption(e.content))}),f.on("BeforeObjectSelected",function(e){var t=e.target,a=f.dom;a.hasClass(t,"mceMediaCreditTemp")&&(a=a.getPrev(t,"img"))&&(e.preventDefault(),f.selection.select(a))}),f.on("dragstart",function(){var e=f.selection.getNode();"IMG"!==e.nodeName||(n=f.dom.getParent(e,".mceTemp"))||"A"!==e.parentNode.nodeName||C(e.parentNode)||(n=e.parentNode)}),f.on("drop",function(e){var t=f.dom,a=tinymce.dom.RangeUtils.getCaretRangeFromPoint(e.clientX,e.clientY,f.getDoc());a&&t.getParent(a.startContainer,".mceTemp")?e.preventDefault():n&&(e.preventDefault(),f.undoManager.transact(function(){a&&f.selection.setRng(a),f.selection.setNode(n),t.remove(n)})),n=null}),f.wp=f.wp||{},f.wp.isPlaceholder=i,{_do_shcode:r,_get_shcode:m}},["noneditable"]);